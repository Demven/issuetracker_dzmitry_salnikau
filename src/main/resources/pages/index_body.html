<body>
<div class="header">
	<div id="menu_btn">
    	<div class="menu_btn_icon"></div>
        <ul class="menu">
       	  <div id="user_menu">
                <li class="menu_item">Profile</li>
                <li class="menu_item">Submit issue</li>
                <a href="main?command=logout"><li class="menu_item">Log out</li></a>
          </div>
            <div id="admin_menu">
		  	  <li class="menu_item" id="create">&#9654; Create
					<ul class="create_menu">
                    	 <li class="menu_item">Project</li>
                         <li class="menu_item">Resolution</li>
                         <li class="menu_item">Priority</li>
                         <li class="menu_item">Type</li>
           	  	  </ul>
       	  	  </li>
                <li class="menu_item" id="users">&#9654; Users
                	<ul class="users_menu">
                    	 <li class="menu_item">Find user</li>
                         <li class="menu_item">Add user</li>
               	  	</ul>
                </li>
              	<li class="menu_item" id="view">&#9654; View
                	<ul class="view_menu">
                    	 <li class="menu_item">Projects</li>
                         <li class="menu_item">Statuses</li>
                         <li class="menu_item">Resolutions</li>
                         <li class="menu_item">Priorities</li>
               	  	</ul>
              	</li>
          </div>
        </ul>
    </div>
 
    <div class="logo"></div>
    
    <div id="user_welcome">
    	<a href=""><span id="submit_issue">Submit issue</span></a> | 
        <a href=""><span id="user_login"></span></a> | 
        <a href="main?command=logout"><span id="log_out">Log out</span></a>
	</div>
    
    <div class="overall_menu">
    	<div class="search_container">
        	<input type="text" id="find_field" placeholder="Find bug"/><div class="search_icon" title="Search"></div>
        </div>
        <div class="auth_container">
        	<form name="auth_form" action="main" method="get">
                <input type="submit" id="sign_in_btn" value="Sign In"/>
                <div id="auth">
                    <input type="hidden" name="command" value="auth"/>
                    <input type="email" name="email" id="email" placeholder="Email" title="Email"/>
                    <input type="password" name="password" id="password" placeholder="Password" title="Password"/>
                </div>
            </form>
		</div>
    </div>
</div>

<div class="content">
	<div id="content_title">Latest issues</div>
    <div class="issue_table">
    	<div class="header_line">
       	  <div class="id">Id</div>
            <div class="priority">Priority</div>
            <div class="assignee">Assignee</div>
          <div class="type">Type</div>
       	  <div class="status">Status</div>
       	  <div class="summary">Summary</div>
        </div>
        <div id="issue_lines">
            <!-- issue-template -->
            <div class="issue_line">
                <div class="id"></div>
                <div class="priority" id="critical"></div>
                <div class="assignee"></div>
                <div class="type"></div>
                <div class="status"></div>
                <div class="summary"></div>
            </div>
		</div>
    </div>
</div>

<script type="text/javascript" language="javascript">
	var MAX_ISSUES = 10;
	var LATEST = "latest";
	var ASSIGNED = "assigned";
	
	parseUserData();
	parseIssuesData();
	
	// parse the data about user, sending by server and prepare page for that user
	function parseUserData(){
		var user_data = document.getElementById("user_data");
		if(user_data){
			// User is authorized
			// So lets hide "Sign In" button
			var auth_container = document.getElementsByClassName("auth_container")[0];
			auth_container.style.display = "none";
			// Margin for the search container
			var search_container = document.getElementsByClassName("search_container")[0];
			search_container.style.marginRight = "10px";
 			// Show menu button
			var menu_btn = document.getElementById("menu_btn");
			menu_btn.style.display = "block";
			
			// Show user welcome menu
			var login = user_data.querySelector("#login");
			if(login){
				showUserWelcome(login.innerHTML.trim());
			}
		}
	}
	
	// Shows and fills user-welcome-menu with a Name and Surname of a user, sets links to his profile and log out
	function showUserWelcome(email){
		// Get name and last name
		var nameArr = (email.split("@")[0]).split("_");
		var firstName = upCaseFirstLetter(nameArr[0].toLowerCase());
		var lastName = upCaseFirstLetter(nameArr[1].toLowerCase());
		// Show menu
		var user_welcome = document.getElementById("user_welcome");
		user_welcome.style.display = "block";
		// Set values
		var user_login = user_welcome.querySelector("#user_login");
		user_login.innerHTML = firstName + " " + lastName;
	}

	// parse all the issues data, sending by server and input it into the table
	function parseIssuesData(){
		var issues_data = document.getElementById("issues_data").querySelectorAll("#issueObject");
		var content_title = document.getElementById("content_title");

		// Define the number of issues
		var issues_number;
		if(issues_data.length > MAX_ISSUES){
			issues_number = MAX_ISSUES;
		} else{
			issues_number = issues_data.length;
		}
		
		// Check whether there is at least one issue
		if(issues_number > 0){
			// Define issues's type and fill the table title
			var issues_type = document.querySelector("#issues_type").innerHTML;
			if(issues_type == LATEST){
				content_title.innerHTML = "Latest issues";
			} else if(issues_type == ASSIGNED){
				content_title.innerHTML = "Assigned issues";
			}
			
			// table
			var table = document.querySelector(".issue_table");
			var issue_lines = table.querySelector("#issue_lines");
			var issue_line_template = issue_lines.innerHTML;
			
			// form html base
			var formed_lines_html = "";
			for(i=0; i < issues_number; i++){
				formed_lines_html = formed_lines_html + issue_line_template;
			}
			issue_lines.innerHTML = formed_lines_html;
			
			var issue_line_list = table.getElementsByClassName("issue_line");
			
			for(i=0; i<issues_number; i++){
				var issueObject = issues_data[i];
				var issue_line = issue_line_list[i];
				// get all parameters
				var issueId = issueObject.querySelector("#issueId").innerHTML;
				var createDate = issueObject.querySelector("#createDate").innerHTML;
				var createdBy = issueObject.querySelector("#createdBy").innerHTML;
				var modifyDate = issueObject.querySelector("#modifyDate").innerHTML;
				var modifiedBy = issueObject.querySelector("#modifiedBy").innerHTML;
				var summary = issueObject.querySelector("#summary").innerHTML;
				var description = issueObject.querySelector("#description").innerHTML;
				var status = issueObject.querySelector("#status").innerHTML;
				var resolution = issueObject.querySelector("#resolution").innerHTML;
				var type = issueObject.querySelector("#type").innerHTML;
				var priority = issueObject.querySelector("#priority").innerHTML;
				var project = issueObject.querySelector("#project").innerHTML;
				var buildFound = issueObject.querySelector("#buildFound").innerHTML;
				var assignee = issueObject.querySelector("#assignee").innerHTML;
				
				issue_line.querySelector(".id").innerHTML = issueId;
				issue_line.querySelector(".priority").innerHTML = upCaseFirstLetter(priority.toLowerCase());
				issue_line.querySelector(".priority").id = priority.toLowerCase();
				issue_line.querySelector(".assignee").innerHTML = assignee;
				issue_line.querySelector(".type").innerHTML = upCaseFirstLetter(type.toLowerCase());
				issue_line.querySelector(".status").innerHTML = upCaseFirstLetter(status.toLowerCase());
				issue_line.querySelector(".summary").innerHTML = summary;
				
			}
		} else{
			// There no issues, so we should show corresponding title
			content_title.innerHTML = "No issues to show";
			// Hide table at all
			(document.getElementsByClassName("issue_table")[0]).style.display = "none";
		}
	}
	
	// Change the first letter in the string to upper case
	function upCaseFirstLetter(string){
		return string.charAt(0).toUpperCase() + string.slice(1);
	}
</script>